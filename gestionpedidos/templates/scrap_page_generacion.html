<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{{ titulo }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* Spinner centrado y oculto por defecto */
        body { padding: 20px; }
        #loading-spinner {
            display: none;
        }
    </style>
</head>
<body class="container">

    <h1>{{ titulo }} &nbsp; <a href="{% url 'home' %}" class="btn btn-secondary">Volver</a> </h1>

    <form method="post" class="mb-3" id="scrap-form">
        {% csrf_token %}
        <div class="row mb-3">
            <div class="col">
                <label for="fecha_inicio" class="form-label">Fecha inicio:</label>
                <input type="date" id="fecha_inicio" name="fecha_inicio" value="{{ fecha_inicio }}" class="form-control">
            </div>
            <div class="col">
                <label for="fecha_fin" class="form-label">Fecha fin:</label>
                <input type="date" id="fecha_fin" name="fecha_fin" value="{{ fecha_fin }}" class="form-control">
            </div>
            <div class="col">
                <label for="tipo_generacion" class="form-label">Tipo de energía:</label>
                <select name="tipo_generacion" id="tipo_generacion" class="form-select">
                    <option value="todos" {% if tipo_generacion == "todos" %}selected{% endif %}>Todos</option>
                    <option value="renovables" {% if tipo_generacion == "renovables" %}selected{% endif %}>Renovables</option>
                    <option value="no_renovables" {% if tipo_generacion == "no_renovables" %}selected{% endif %}>No Renovables</option>
                </select>
            </div>
            <div class="col d-flex align-items-end">
                <button type="submit" class="btn btn-primary">Filtrar</button>
                {% if data %}
                    <button type="submit" name="download_csv" class="btn btn-success">Descargar CSV</button>
                {% endif %}
        </div>
    </form>

    <!-- Spinner de carga -->
    <div id="loading-spinner">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Cargando...</span>
        </div>
    </div>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if data %}
        <div class="mt-4">
            <h5>Mostrando 10 filas de {{ total_rows }}:</h5>
            {{ data|safe }}
        </div>
        <div class="mt-3">
            <a href="{% url 'scrap_view_graph' %}" class="btn btn-info">Visualizar</a>
        </div>
    {% endif %}

    <script>
        // Mostrar el spinner cuando se envía el formulario
        const form = document.getElementById('scrap-form');
        const spinner = document.getElementById('loading-spinner');

        form.addEventListener('submit', function() {
            spinner.style.display = 'block';
        });
    </script>

</body>
</html>
