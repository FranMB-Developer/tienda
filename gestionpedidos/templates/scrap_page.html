<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Scraping Demanda REE</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        #spinner { display: none; }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <h1 class="mb-4">Scraping Demanda Eléctrica REE</h1>

        <form method="post" class="row g-3" onsubmit="showSpinner(event)">
            {% csrf_token %}
            <div class="col-md-4">
                <label for="fecha_inicio" class="form-label">Fecha inicio</label>
                <input type="date" id="fecha_inicio" name="fecha_inicio" value="{{ fecha_inicio }}" required class="form-control">
            </div>
            <div class="col-md-4">
                <label for="fecha_fin" class="form-label">Fecha fin</label>
                <input type="date" id="fecha_fin" name="fecha_fin" value="{{ fecha_fin }}" required class="form-control">
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">Scrapear</button>
                <button type="submit" name="download_csv" value="1" class="btn btn-success">Descargar CSV</button>
            </div>
        </form>

        <div id="spinner" class="mt-4 text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p>Scrapeando datos, por favor espera...</p>
        </div>

        {% if error %}
            <div class="alert alert-danger mt-4">{{ error }}</div>
        {% endif %}

        {% if data %}
            <div class="mt-4">
                <h3>Resultados (primeras 10 filas de {{ total_rows }})</h3>
                {{ data|safe }}
            </div>
            <div class="mt-3">
                <form method="get" action="{% url 'scrap_view_graph' %}">
                    <button type="submit" class="btn btn-info">Visualizar</button>
                </form>
            </div>
        {% endif %}
        
    </div>

    <script>
        function showSpinner(event) {
            // Solo mostramos el spinner si se pulsó el botón "Scrapear"
            if (event.submitter && event.submitter.innerText.trim() === "Scrapear") {
                document.getElementById("spinner").style.display = "block";
            }
        }
    </script>
</body>
</html>
